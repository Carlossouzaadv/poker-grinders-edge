# Snapshot Schema Documentation

## Overview

This document describes the snapshot schema used in the poker hand replayer to track game state throughout hand progression.

## Snapshot Structure

Each snapshot represents the game state at a specific point in time and contains:

```typescript
interface Snapshot {
  // Basic state
  pot: number;
  communityCards: Card[];
  playerStacks: Record<string, number>;

  // Action tracking
  actions: Action[];
  currentStreet: 'preflop' | 'flop' | 'turn' | 'river' | 'showdown';

  // Advanced tracking (added for side pot analysis)
  totalCommitted?: Record<string, number>;  // Total chips committed by each player (in cents)
  payouts?: Record<string, number>;          // Final chip distribution (in cents)
  playerStacksPostShowdown?: Record<string, number>; // Final stacks after showdown
  isAllIn?: Record<string, boolean>;         // All-in status tracking

  // Metadata
  winners?: string[];
  potWon?: number;
}
```

## Side Pot Integration

The snapshot system integrates with the side pot calculation engine to provide:

1. **Precise Tracking**: All monetary values stored as integer cents to prevent floating-point errors
2. **Eligibility Determination**: Player status tracked throughout hand progression
3. **Mathematical Verification**: Automatic validation that `sum(payouts) === sum(totalCommitted)`

## Canonical Rules Applied

The snapshot system enforces the canonical side pot rules documented in `sidepot-rules.md`:

- Single eligible players automatically win their pots
- Eligibility determined at pot creation time based on commitment levels and fold timing
- All chip movements must be mathematically consistent

## Usage

Snapshots are generated by `SnapshotBuilder.buildSnapshots()` and consumed by the replay system to show accurate game progression with proper side pot handling.