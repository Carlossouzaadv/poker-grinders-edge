# Guia de Contribui√ß√£o

Obrigado por considerar contribuir com o **Poker Grinder's Edge**! Este guia ajudar√° voc√™ a configurar o ambiente de desenvolvimento e entender nossos padr√µes de c√≥digo.

## üìã √çndice

- [C√≥digo de Conduta](#c√≥digo-de-conduta)
- [Primeiros Passos](#primeiros-passos)
- [Configurando o Ambiente](#configurando-o-ambiente)
- [Padr√µes de C√≥digo](#padr√µes-de-c√≥digo)
- [Workflow Git](#workflow-git)
- [Testes](#testes)
- [Documenta√ß√£o](#documenta√ß√£o)
- [Pull Requests](#pull-requests)

## C√≥digo de Conduta

Ao contribuir com este projeto, voc√™ concorda em manter um ambiente respeitoso e colaborativo. Esperamos:

- ‚úÖ Respeito m√∫tuo entre todos os colaboradores
- ‚úÖ Feedback construtivo e profissional
- ‚úÖ Foco na qualidade t√©cnica e boas pr√°ticas
- ‚ùå N√£o toleramos discrimina√ß√£o, ass√©dio ou comportamento ofensivo

## Primeiros Passos

### O que voc√™ pode fazer?

- üêõ **Reportar bugs**: Abra uma issue descrevendo o problema
- ‚ú® **Sugerir features**: Proponha novas funcionalidades
- üìù **Melhorar documenta√ß√£o**: Corrija erros ou adicione exemplos
- üîß **Resolver issues**: Escolha uma issue aberta e trabalhe nela
- üß™ **Adicionar testes**: Aumente a cobertura de testes

### Escolhendo uma Issue

1. Veja as [issues abertas](../../issues)
2. Procure por labels como `good first issue` ou `help wanted`
3. Comente na issue que voc√™ quer trabalhar nela
4. Aguarde confirma√ß√£o de um mantenedor antes de come√ßar

## Configurando o Ambiente

### Pr√©-requisitos

- **Node.js** 18+ ([Download](https://nodejs.org/))
- **PostgreSQL** 14+ ([Download](https://www.postgresql.org/download/))
- **Git** ([Download](https://git-scm.com/downloads))
- **VS Code** (recomendado) com extens√µes:
  - ESLint
  - Prettier
  - Prisma

### Clone e Configura√ß√£o

```bash
# 1. Fork o reposit√≥rio no GitHub

# 2. Clone seu fork
git clone https://github.com/SEU-USUARIO/poker-grinders-edge.git
cd poker-grinders-edge

# 3. Adicione o reposit√≥rio original como remote
git remote add upstream https://github.com/ORIGINAL/poker-grinders-edge.git

# 4. Configure o backend
cd backend
npm install
cp .env.example .env
# Edite .env com suas configura√ß√µes locais

# 5. Configure o banco de dados
createdb poker_grinders_edge_dev
npx prisma migrate dev
npx prisma generate

# 6. Rode o backend
npm run start:dev

# 7. Em outro terminal, configure o mobile
cd ../mobile
npm install

# 8. Rode o app (escolha iOS ou Android)
npx react-native run-android
# ou
npx react-native run-ios
```

## Padr√µes de C√≥digo

### TypeScript

Usamos **TypeScript estrito** em todo o projeto. Sempre:

- ‚úÖ Defina tipos expl√≠citos para par√¢metros e retornos
- ‚úÖ Use interfaces para objetos complexos
- ‚úÖ Evite `any` - use `unknown` ou tipos espec√≠ficos
- ‚ùå Nunca desabilite regras do ESLint sem justificativa

**Exemplo bom**:
```typescript
interface CreateSessionDto {
  gameType: GameType;
  buyIn: number;
  result: number;
}

async function createSession(dto: CreateSessionDto): Promise<Session> {
  // ...
}
```

**Exemplo ruim**:
```typescript
function createSession(dto: any): any { // ‚ùå Nunca use any
  // ...
}
```

### Nomenclatura

#### Arquivos
- Componentes React: `PascalCase.tsx` (ex: `SessionCard.tsx`)
- Services: `camelCase.service.ts` (ex: `authService.ts`)
- DTOs: `kebab-case.dto.ts` (ex: `create-session.dto.ts`)
- Interfaces: `PascalCase.interface.ts` (ex: `Session.interface.ts`)

#### C√≥digo
- **Vari√°veis e fun√ß√µes**: `camelCase`
- **Classes e Interfaces**: `PascalCase`
- **Constantes**: `UPPER_SNAKE_CASE`
- **Arquivos privados**: prefixo `_` (ex: `_helpers.ts`)

### Backend (NestJS)

#### Estrutura de M√≥dulos

Cada m√≥dulo funcional deve seguir:

```
modules/feature-name/
‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îú‚îÄ‚îÄ create-feature.dto.ts
‚îÇ   ‚îî‚îÄ‚îÄ update-feature.dto.ts
‚îú‚îÄ‚îÄ interfaces/
‚îÇ   ‚îî‚îÄ‚îÄ feature.interface.ts
‚îú‚îÄ‚îÄ feature.controller.ts
‚îú‚îÄ‚îÄ feature.service.ts
‚îú‚îÄ‚îÄ feature.module.ts
‚îî‚îÄ‚îÄ __tests__/
    ‚îú‚îÄ‚îÄ feature.controller.spec.ts
    ‚îî‚îÄ‚îÄ feature.service.spec.ts
```

#### DTOs (Data Transfer Objects)

Use `class-validator` para valida√ß√£o:

```typescript
import { IsNotEmpty, IsNumber, IsEnum, Min } from 'class-validator';

export class CreateSessionDto {
  @IsNotEmpty()
  @IsEnum(GameType)
  gameType: GameType;

  @IsNumber()
  @Min(0, { message: 'Buy-in deve ser positivo' })
  buyIn: number;

  @IsNumber()
  result: number;
}
```

#### Services

Services devem:
- Ter **responsabilidade √∫nica** (Single Responsibility Principle)
- Injetar depend√™ncias via constructor
- Retornar tipos expl√≠citos
- Lan√ßar exce√ß√µes do NestJS (`NotFoundException`, `BadRequestException`, etc)

```typescript
import { Injectable, NotFoundException } from '@nestjs/common';

@Injectable()
export class SessionsService {
  constructor(private prisma: PrismaService) {}

  async findOne(id: string): Promise<Session> {
    const session = await this.prisma.session.findUnique({
      where: { id }
    });

    if (!session) {
      throw new NotFoundException('Sess√£o n√£o encontrada');
    }

    return session;
  }
}
```

#### Controllers

Controllers devem:
- Ser enxutos (delegar l√≥gica para services)
- Usar decorators apropriados (`@Get`, `@Post`, etc)
- Aplicar guards quando necess√°rio (`@UseGuards(JwtAuthGuard)`)
- Retornar DTOs de resposta (n√£o entidades direto do banco)

```typescript
import { Controller, Get, Param, UseGuards } from '@nestjs/common';
import { JwtAuthGuard } from '@/common/guards/jwt-auth.guard';

@Controller('sessions')
@UseGuards(JwtAuthGuard)
export class SessionsController {
  constructor(private sessionsService: SessionsService) {}

  @Get(':id')
  async findOne(@Param('id') id: string): Promise<SessionResponseDto> {
    return this.sessionsService.findOne(id);
  }
}
```

### Frontend (React Native / Next.js)

#### Componentes

- Use **function components** com hooks (n√£o class components)
- Extraia l√≥gica complexa para custom hooks
- Memoize componentes pesados com `React.memo()`
- Componentes pequenos e focados (m√°ximo 200 linhas)

```typescript
import React from 'react';
import { View, Text } from 'react-native';

interface SessionCardProps {
  session: Session;
  onPress: (id: string) => void;
}

export const SessionCard: React.FC<SessionCardProps> = ({ session, onPress }) => {
  const handlePress = () => onPress(session.id);

  return (
    <View>
      <Text>{session.gameType}</Text>
      <Text>Buy-in: ${session.buyIn}</Text>
    </View>
  );
};
```

#### State Management (Zustand)

Stores devem ser:
- Pequenos e focados em um dom√≠nio
- Ter a√ß√µes claramente definidas
- Usar TypeScript para type safety

```typescript
import { create } from 'zustand';

interface AuthState {
  user: User | null;
  token: string | null;
  isAuthenticated: boolean;
  login: (email: string, password: string) => Promise<void>;
  logout: () => void;
}

export const useAuthStore = create<AuthState>((set) => ({
  user: null,
  token: null,
  isAuthenticated: false,

  login: async (email, password) => {
    const response = await authService.login(email, password);
    set({
      user: response.user,
      token: response.access_token,
      isAuthenticated: true
    });
  },

  logout: () => {
    set({ user: null, token: null, isAuthenticated: false });
  }
}));
```

### Coment√°rios e Documenta√ß√£o

#### JSDoc

Use JSDoc para **todas** as fun√ß√µes e classes p√∫blicas:

```typescript
/**
 * @method uploadHandHistory
 * @description Faz upload e processa um arquivo de Hand History completo.
 *
 * @param {UploadHandHistoryDto} uploadDto - Dados do upload
 * @param {string} userId - ID do usu√°rio
 * @returns {Promise<SessionResponseDto>} Sess√£o criada + primeira m√£o parseada
 * @throws {BadRequestException} Se nenhuma m√£o v√°lida encontrada
 *
 * @example
 * ```typescript
 * const result = await service.uploadHandHistory({
 *   rawHandHistory: 'PokerStars Hand #123...',
 *   name: 'MTT Sunday'
 * }, userId);
 * ```
 */
async uploadHandHistory(
  uploadDto: UploadHandHistoryDto,
  userId: string,
): Promise<SessionResponseDto> {
  // ...
}
```

#### Coment√°rios Inline

Use coment√°rios inline para:
- Explicar **por que** algo √© feito (n√£o **o que** √© feito)
- L√≥gica complexa ou n√£o √≥bvia
- TODOs e FIXMEs

```typescript
// ‚úÖ Bom: explica o "porqu√™"
// Usamos bcrypt com 12 rounds para balancear seguran√ßa e performance
const hashedPassword = await bcrypt.hash(password, 12);

// ‚ùå Ruim: explica o √≥bvio
// Faz hash da senha
const hashedPassword = await bcrypt.hash(password, 12);
```

## Workflow Git

### Branches

Usamos **Git Flow** simplificado:

- `main` - C√≥digo em produ√ß√£o (protegida)
- `develop` - Branch de desenvolvimento (protegida)
- `feat/nome-feature` - Novas funcionalidades
- `fix/nome-bug` - Corre√ß√µes de bugs
- `docs/nome-doc` - Melhorias na documenta√ß√£o
- `refactor/nome` - Refatora√ß√µes
- `test/nome` - Adi√ß√£o de testes

### Commits

Seguimos [Conventional Commits](https://www.conventionalcommits.org/):

**Formato**: `<tipo>(<escopo>): <mensagem>`

**Tipos**:
- `feat` - Nova funcionalidade
- `fix` - Corre√ß√£o de bug
- `docs` - Mudan√ßas na documenta√ß√£o
- `style` - Formata√ß√£o (n√£o muda l√≥gica)
- `refactor` - Refatora√ß√£o de c√≥digo
- `test` - Adi√ß√£o ou corre√ß√£o de testes
- `chore` - Mudan√ßas em build, CI, etc

**Exemplos**:
```bash
feat(bankroll): add session tracking for tournaments
fix(auth): correct password hashing bug
docs(readme): update setup instructions
refactor(parser): extract PokerStars parser to Strategy Pattern
test(sessions): add unit tests for SessionsService
```

### Workflow

```bash
# 1. Atualize sua branch develop
git checkout develop
git pull upstream develop

# 2. Crie uma branch para sua feature
git checkout -b feat/minha-feature

# 3. Fa√ßa suas mudan√ßas e commits
git add .
git commit -m "feat(module): add new feature"

# 4. Mantenha sua branch atualizada
git fetch upstream
git rebase upstream/develop

# 5. Push para seu fork
git push origin feat/minha-feature

# 6. Abra um Pull Request no GitHub
```

## Testes

### Cobertura M√≠nima

- **Backend**: 80% de cobertura
- **Frontend**: 60% de cobertura (componentes cr√≠ticos)

### Backend (Jest)

#### Testes Unit√°rios (Services)

```typescript
// sessions.service.spec.ts
import { Test, TestingModule } from '@nestjs/testing';
import { SessionsService } from './sessions.service';
import { PrismaService } from '@/database/prisma.service';

describe('SessionsService', () => {
  let service: SessionsService;
  let prisma: PrismaService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [
        SessionsService,
        {
          provide: PrismaService,
          useValue: {
            session: {
              create: jest.fn(),
              findUnique: jest.fn(),
            }
          }
        }
      ],
    }).compile();

    service = module.get<SessionsService>(SessionsService);
    prisma = module.get<PrismaService>(PrismaService);
  });

  it('should create a session', async () => {
    const dto = { gameType: 'CASH', buyIn: 100, result: 150 };
    const mockSession = { id: '1', ...dto };

    jest.spyOn(prisma.session, 'create').mockResolvedValue(mockSession as any);

    const result = await service.create(dto, 'user-id');

    expect(result).toEqual(mockSession);
    expect(prisma.session.create).toHaveBeenCalledWith({
      data: { ...dto, userId: 'user-id' }
    });
  });
});
```

#### Testes E2E (Endpoints)

```typescript
// sessions.e2e-spec.ts
import { Test } from '@nestjs/testing';
import { INestApplication } from '@nestjs/common';
import * as request from 'supertest';
import { AppModule } from '@/app.module';

describe('SessionsController (e2e)', () => {
  let app: INestApplication;
  let authToken: string;

  beforeAll(async () => {
    const moduleRef = await Test.createTestingModule({
      imports: [AppModule],
    }).compile();

    app = moduleRef.createNestApplication();
    await app.init();

    // Login para obter token
    const loginResponse = await request(app.getHttpServer())
      .post('/auth/login')
      .send({ email: 'test@test.com', password: 'password' });

    authToken = loginResponse.body.access_token;
  });

  it('/sessions (POST)', () => {
    return request(app.getHttpServer())
      .post('/sessions')
      .set('Authorization', `Bearer ${authToken}`)
      .send({ gameType: 'CASH', buyIn: 100, result: 150 })
      .expect(201)
      .expect((res) => {
        expect(res.body).toHaveProperty('id');
        expect(res.body.buyIn).toBe(100);
      });
  });

  afterAll(async () => {
    await app.close();
  });
});
```

### Rodando Testes

```bash
# Backend
cd backend

# Todos os testes
npm run test

# Testes em watch mode
npm run test:watch

# Testes e2e
npm run test:e2e

# Coverage
npm run test:cov
```

## Documenta√ß√£o

### O que documentar?

- ‚úÖ Todas as fun√ß√µes e classes p√∫blicas (JSDoc)
- ‚úÖ L√≥gica complexa ou n√£o √≥bvia (coment√°rios inline)
- ‚úÖ Decis√µes de design importantes (ARCHITECTURE.md)
- ‚úÖ Novos padr√µes ou utilit√°rios (exemplos de uso)
- ‚ùå N√£o documente o √≥bvio

### Onde documentar?

- **JSDoc**: C√≥digo TypeScript (.ts, .tsx)
- **README.md**: Vis√£o geral do projeto e setup r√°pido
- **ARCHITECTURE.md**: Arquitetura, padr√µes de design, fluxo de dados
- **CONTRIBUTING.md**: Este arquivo (guia para desenvolvedores)
- **Coment√°rios inline**: Explica√ß√µes de l√≥gica complexa

## Pull Requests

### Antes de Abrir um PR

- ‚úÖ Seu c√≥digo compila sem erros (`npm run build`)
- ‚úÖ Todos os testes passam (`npm run test`)
- ‚úÖ Voc√™ seguiu os padr√µes de c√≥digo
- ‚úÖ Voc√™ adicionou/atualizou testes
- ‚úÖ Voc√™ adicionou/atualizou documenta√ß√£o
- ‚úÖ Voc√™ rodou o linter (`npm run lint`)

### Template de PR

```markdown
## Descri√ß√£o

[Descreva brevemente o que este PR faz]

## Tipo de Mudan√ßa

- [ ] üêõ Bug fix (mudan√ßa que corrige um problema)
- [ ] ‚ú® Nova feature (mudan√ßa que adiciona funcionalidade)
- [ ] üí• Breaking change (mudan√ßa que quebra compatibilidade)
- [ ] üìù Documenta√ß√£o

## Como Testar?

[Descreva os passos para testar suas mudan√ßas]

1. Clone o branch
2. Execute `npm install`
3. Execute `npm run test`
4. ...

## Checklist

- [ ] C√≥digo compila sem erros
- [ ] Testes passam
- [ ] Adicionei testes para novas funcionalidades
- [ ] Atualizei a documenta√ß√£o
- [ ] Segui os padr√µes de c√≥digo do projeto
- [ ] Commits seguem Conventional Commits

## Screenshots (se aplic√°vel)

[Adicione screenshots se houver mudan√ßas visuais]
```

### Revis√£o de C√≥digo

Espere feedback de mantenedores. Esteja aberto a:

- Sugest√µes de melhoria
- Solicita√ß√µes de mudan√ßas
- Discuss√µes sobre abordagens alternativas

## Perguntas?

- üí¨ Abra uma [Discussion](../../discussions)
- üêõ Reporte bugs via [Issues](../../issues)
- üìß Entre em contato: [email do projeto]

---

**Obrigado por contribuir!** üéâ

Toda contribui√ß√£o, grande ou pequena, √© muito apreciada e ajuda a tornar o Poker Grinder's Edge melhor para toda a comunidade.
